<Window
    x:Class="StarResonanceDpsAnalysis.WPF.Views.SettingsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:behaviors="clr-namespace:StarResonanceDpsAnalysis.WPF.Behaviors"
    xmlns:ctrl="clr-namespace:StarResonanceDpsAnalysis.WPF.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:lex="http://wpflocalizeextension.codeplex.com"
    xmlns:loc="clr-namespace:StarResonanceDpsAnalysis.WPF.Properties"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vms="clr-namespace:StarResonanceDpsAnalysis.WPF.ViewModels"
    Title="{lex:Loc Key={x:Static loc:ResourcesKeys.Window_Settings_Title}}"
    Width="780"
    Height="690"
    MinWidth="660"
    MinHeight="540"
    d:DataContext="{d:DesignInstance Type=vms:SettingsDesignTimeViewModel,
                                     IsDesignTimeCreatable=True}"
    d:DesignHeight="3000"
    lex:LocalizeDictionary.DesignCulture="zh-CN"
    lex:ResxLocalizationProvider.DefaultAssembly="StarResonanceDpsAnalysis.WPF"
    lex:ResxLocalizationProvider.DefaultDictionary="Resources"
    PreviewKeyDown="Window_PreviewKeyDown"
    Style="{StaticResource TransparentWindow}"
    mc:Ignorable="d">

    <!--  WindowChrome: 开启可拉伸边界  -->
    <WindowChrome.WindowChrome>
        <WindowChrome
            CaptionHeight="0"
            GlassFrameThickness="0"
            ResizeBorderThickness="6"
            UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>

    <b:Interaction.Triggers>
        <b:EventTrigger EventName="Loaded">
            <b:InvokeCommandAction Command="{Binding LoadedCommand}" />
        </b:EventTrigger>
    </b:Interaction.Triggers>

    <Window.Resources>

        <Style x:Key="SelectedIconfont" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="pack://application:,,,/Assets/Fonts/#IconFont" />
            <Setter Property="Foreground" Value="#FFF" />
            <Setter Property="VerticalAlignment" Value="Bottom" />
            <Setter Property="HorizontalAlignment" Value="Right" />
            <Setter Property="Margin" Value="2" />
        </Style>

        <Style x:Key="SettingSectionListBorder" TargetType="Border">
            <Setter Property="Margin" Value="10" />
            <Setter Property="CornerRadius" Value="5" />
            <Setter Property="Background" Value="#FFF" />
        </Style>

        <Style x:Key="SettingSectionListTitleBorder" TargetType="Border">
            <Setter Property="Background" Value="#2297F4" />
            <Setter Property="Padding" Value="10" />
            <Setter Property="CornerRadius" Value="5,5,0,0" />
        </Style>

        <Style
            x:Key="SettingSectionListTitle"
            BasedOn="{StaticResource NormalTextBlockBaseStyle}"
            TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FFF" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="FontSize" Value="16" />
        </Style>

        <Style x:Key="SectionTitleButton" TargetType="Button">
            <Setter Property="BorderBrush" Value="#EEE" />
            <Setter Property="BorderThickness" Value="0,0,0,1" />
        </Style>

        <Style x:Key="SectionTitleBorder" TargetType="Border">
            <Setter Property="Padding" Value="10" />
        </Style>

        <Style
            x:Key="SectionListTitleText"
            BasedOn="{StaticResource NormalTextBlockBaseStyle}"
            TargetType="TextBlock" />

        <Style x:Key="SectionTitlePointer" TargetType="Border">
            <Setter Property="Width" Value="8" />
            <Setter Property="Height" Value="8" />
            <Setter Property="HorizontalAlignment" Value="Right" />
            <Setter Property="BorderBrush" Value="#000" />
            <Setter Property="BorderThickness" Value="0,1,1,0" />
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <RotateTransform Angle="45" />
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SettingDetailListBorder" TargetType="Border">
            <Setter Property="Margin" Value="10" />
            <Setter Property="Padding" Value="20,20,5,0" />
            <Setter Property="CornerRadius" Value="5" />
            <Setter Property="Background" Value="#FFF" />
        </Style>

        <Style x:Key="SectionBorder" TargetType="Border">
            <Setter Property="BorderBrush" Value="#E5E5E5" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="Margin" Value="0,0,10,30" />
        </Style>


        <Style x:Key="SectionStackPanel" TargetType="StackPanel" />

        <Style x:Key="SectionFieldBorderBase" TargetType="Border">
            <Setter Property="Padding" Value="20,10,10,10" />
        </Style>

        <Style
            x:Key="SectionFieldBorder"
            BasedOn="{StaticResource SectionFieldBorderBase}"
            TargetType="Border">
            <Setter Property="BorderBrush" Value="#E5E5E5" />
            <Setter Property="BorderThickness" Value="0,0,0,2" />
        </Style>

        <Style
            x:Key="FieldName"
            BasedOn="{StaticResource NormalTextBlockBaseStyle}"
            TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="FontSize" Value="14" />
        </Style>

        <Style
            x:Key="FieldComboBox"
            BasedOn="{StaticResource AntComboBoxStyle}"
            TargetType="ComboBox">
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <Style
            x:Key="AutoSelectButton"
            BasedOn="{StaticResource AntPrimaryButtonStyle}"
            TargetType="Button">
            <Setter Property="Padding" Value="15,0,15,0" />
        </Style>

        <Style
            x:Key="SuffixText"
            BasedOn="{StaticResource NormalTextBlockBaseStyle}"
            TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="FontSize" Value="14" />
        </Style>

        <Style x:Key="ThemeButtonBorder" TargetType="Border">
            <Setter Property="BorderBrush" Value="#EEE" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="5" />
        </Style>

        <Style x:Key="ThemeButton" TargetType="Button">
            <Setter Property="Width" Value="30" />
            <Setter Property="Height" Value="30" />
            <Setter Property="HorizontalAlignment" Value="Left" />
            <Setter Property="VerticalAlignment" Value="Top" />
            <Setter Property="BorderBrush" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Margin" Value="0,0,5,0" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate>
                        <Border Background="{TemplateBinding Background}" Style="{StaticResource ThemeButtonBorder}" />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style
            x:Key="ThemeButton_Active"
            BasedOn="{StaticResource ThemeButton}"
            TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate>
                        <Border Background="{TemplateBinding Background}" Style="{StaticResource ThemeButtonBorder}">
                            <TextBlock Style="{StaticResource SelectedIconfont}" Text="&#xe64d;" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style
            x:Key="ImageSelectButton"
            BasedOn="{StaticResource AntButtonStyle}"
            TargetType="Button">
            <Setter Property="Padding" Value="12,4,12,4" />
        </Style>

        <DataTemplate x:Key="LocalizedEnumTextBlockDataTemplate">
            <TextBlock Text="{Binding Display}" />
        </DataTemplate>

    </Window.Resources>

    <Border Background="#ECEBE9" Style="{StaticResource ShadowWindowBorder}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <ctrl:Header Title="{lex:Loc Key={x:Static loc:ResourcesKeys.Window_Settings_Title}}" Grid.Row="0" />

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" MinWidth="200" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Style="{StaticResource SettingSectionListBorder}">
                    <StackPanel>

                        <Border Style="{StaticResource SettingSectionListTitleBorder}">
                            <TextBlock Style="{StaticResource SettingSectionListTitle}"
                                       Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Window_Settings_Title}}" />
                        </Border>

                        <Button Click="Nav_Language_Click" Style="{StaticResource SectionTitleButton}">
                            <Button.Template>
                                <ControlTemplate>
                                    <Border x:Name="bb" Style="{StaticResource SectionTitleBorder}">

                                        <Grid>
                                            <TextBlock Style="{StaticResource SectionListTitleText}"
                                                       Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Display_Title}}" />

                                            <Border Style="{StaticResource SectionTitlePointer}" />
                                        </Grid>
                                    </Border>

                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="bb" Property="Background" Value="#EEE" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <Button Click="Nav_Basic_Click" Style="{StaticResource SectionTitleButton}">
                            <Button.Template>
                                <ControlTemplate>
                                    <Border x:Name="bb" Style="{StaticResource SectionTitleBorder}">

                                        <Grid>
                                            <TextBlock Style="{StaticResource SectionListTitleText}"
                                                       Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Basic_Title}}" />

                                            <Border Style="{StaticResource SectionTitlePointer}" />
                                        </Grid>
                                    </Border>

                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="bb" Property="Background" Value="#EEE" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <Button Click="Nav_Shortcut_Click" Style="{StaticResource SectionTitleButton}">
                            <Button.Template>
                                <ControlTemplate>
                                    <Border x:Name="bb" Style="{StaticResource SectionTitleBorder}">

                                        <Grid>
                                            <TextBlock Style="{StaticResource SectionListTitleText}"
                                                       Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Shortcut_Title}}" />

                                            <Border Style="{StaticResource SectionTitlePointer}" />
                                        </Grid>
                                    </Border>

                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="bb" Property="Background" Value="#EEE" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <Button Click="Nav_Character_Click" Style="{StaticResource SectionTitleButton}">
                            <Button.Template>
                                <ControlTemplate>
                                    <Border x:Name="bb" Style="{StaticResource SectionTitleBorder}">

                                        <Grid>
                                            <TextBlock Style="{StaticResource SectionListTitleText}"
                                                       Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Character_Title}}" />

                                            <Border Style="{StaticResource SectionTitlePointer}" />
                                        </Grid>
                                    </Border>

                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="bb" Property="Background" Value="#EEE" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <Button Click="Nav_Combat_Click" Style="{StaticResource SectionTitleButton}">
                            <Button.Template>
                                <ControlTemplate>
                                    <Border x:Name="bb" Style="{StaticResource SectionTitleBorder}">

                                        <Grid>
                                            <TextBlock Style="{StaticResource SectionListTitleText}"
                                                       Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Combat_Title}}" />

                                            <Border Style="{StaticResource SectionTitlePointer}" />
                                        </Grid>
                                    </Border>

                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="bb" Property="Background" Value="#EEE" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <Button Click="Nav_Theme_Click" Style="{StaticResource SectionTitleButton}">
                            <Button.Template>
                                <ControlTemplate>
                                    <Border x:Name="bb" Style="{StaticResource SectionTitleBorder}">

                                        <Grid>
                                            <TextBlock Style="{StaticResource SectionListTitleText}"
                                                       Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Theme_Title}}" />

                                            <Border Style="{StaticResource SectionTitlePointer}" />
                                        </Grid>
                                    </Border>

                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="bb" Property="Background" Value="#EEE" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                    </StackPanel>
                </Border>

                <Border Grid.Column="1" Style="{StaticResource SettingDetailListBorder}">
                    <ScrollViewer x:Name="ContentScrollViewer" VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <ctrl:CardHeader
                                x:Name="SectionLanguage"
                                Title="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Display_Title}}"
                                Subtitle="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Language_Description}}" />

                            <Border Style="{StaticResource SectionBorder}">
                                <StackPanel Style="{StaticResource SectionStackPanel}">

                                    <Border Style="{StaticResource SectionFieldBorder}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Language_Title}}" />
                                            <ComboBox
                                                Grid.Column="2"
                                                ItemTemplate="{StaticResource LocalizedEnumTextBlockDataTemplate}"
                                                ItemsSource="{Binding AvailableLanguages}"
                                                SelectedItem="{Binding SelectedLanguage, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{StaticResource FieldComboBox}" />
                                        </Grid>
                                    </Border>

                                    <Border Style="{StaticResource SectionFieldBorderBase}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Display_PlayerNameBlur}}" />
                                            <Border Grid.Column="2" HorizontalAlignment="Right">
                                                <ctrl:SwitchControl
                                                    IsChecked="{Binding AppConfig.MaskPlayerName, Mode=TwoWay}"
                                                    OffContent="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Switch_Off}}"
                                                    OnContent="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Switch_On}}" />
                                            </Border>
                                        </Grid>
                                    </Border>

                                </StackPanel>
                            </Border>

                            <ctrl:CardHeader
                                x:Name="SectionBasic"
                                Title="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Basic_Title}}"
                                Subtitle="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Basic_Sub}}" />

                            <Border Style="{StaticResource SectionBorder}">
                                <StackPanel Style="{StaticResource SectionStackPanel}">

                                    <Border Style="{StaticResource SectionFieldBorderBase}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_NetworkAdapter_Label}}" />
                                            <Grid Grid.Column="2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="10" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <ComboBox
                                                    Grid.Column="0"
                                                    DisplayMemberPath="Description"
                                                    ItemsSource="{Binding AvailableNetworkAdapters, UpdateSourceTrigger=PropertyChanged}"
                                                    SelectedItem="{Binding AppConfig.PreferredNetworkAdapter, Mode=TwoWay}"
                                                    SelectedValuePath="Description"
                                                    Style="{StaticResource AntComboBoxStyle}" />
                                                <Button
                                                    Grid.Column="2"
                                                    Command="{Binding NetworkAdapterAutoSelectCommand}"
                                                    Content="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_NetworkAdapterAutoSelect_Button}}"
                                                    Style="{StaticResource AutoSelectButton}" />
                                            </Grid>
                                        </Grid>
                                    </Border>

                                </StackPanel>
                            </Border>

                            <ctrl:CardHeader
                                x:Name="SectionShortcut"
                                Title="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Shortcut_Title}}"
                                Subtitle="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Shortcut_Sub}}" />

                            <Border Style="{StaticResource SectionBorder}">
                                <StackPanel Style="{StaticResource SectionStackPanel}">

                                    <Border Style="{StaticResource SectionFieldBorder}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Shortcut_MouseThrough}}" />
                                            <TextBox
                                                x:Name="MouseThroughTextBox"
                                                Grid.Column="2"
                                                IsReadOnly="True"
                                                Style="{StaticResource AntTextBoxStyle}"
                                                Text="{Binding AppConfig.MouseThroughShortcut, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource KeyToStringConverter}}"
                                                ToolTip="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Shortcut_MouseThrough_Tooltip}}">
                                                <b:Interaction.Behaviors>
                                                    <behaviors:KeyDownCommandBehavior
                                                        Command="{Binding HandleMouseThroughShortcutCommand}" />
                                                </b:Interaction.Behaviors>
                                            </TextBox>
                                        </Grid>
                                    </Border>

                                    <Border Style="{StaticResource SectionFieldBorder}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Shortcut_ClearData}}" />
                                            <TextBox
                                                x:Name="ClearDataTextBox"
                                                Grid.Column="2"
                                                IsReadOnly="True"
                                                Style="{StaticResource AntTextBoxStyle}"
                                                Text="{Binding AppConfig.ClearDataShortcut, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource KeyToStringConverter}}"
                                                ToolTip="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Shortcut_ClearData_Tooltip}}">
                                                <b:Interaction.Behaviors>
                                                    <behaviors:KeyDownCommandBehavior
                                                        Command="{Binding HandleClearDataShortcutCommand}" />
                                                </b:Interaction.Behaviors>
                                            </TextBox>
                                        </Grid>
                                    </Border>

                                    <Border Style="{StaticResource SectionFieldBorder}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Shortcut_TopMost}}" />
                                            <TextBox
                                                x:Name="TopMostTextBox"
                                                Grid.Column="2"
                                                IsReadOnly="True"
                                                Style="{StaticResource AntTextBoxStyle}"
                                                Text="{Binding AppConfig.TopmostShortcut, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource KeyToStringConverter}}"
                                                ToolTip="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Shortcut_TopMost_Tooltip}}">
                                                <b:Interaction.Behaviors>
                                                    <behaviors:KeyDownCommandBehavior
                                                        Command="{Binding HandleTopMostShortcutCommand}" />
                                                </b:Interaction.Behaviors>
                                            </TextBox>
                                        </Grid>
                                    </Border>

                                </StackPanel>
                            </Border>

                            <!--  角色设置区域  -->
                            <ctrl:CardHeader
                                x:Name="SectionCharacter"
                                Title="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Character_Title}}"
                                Subtitle="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Character_Sub}}" />

                            <Border Style="{StaticResource SectionBorder}">
                                <StackPanel Style="{StaticResource SectionStackPanel}">

                                    <Border Style="{StaticResource SectionFieldBorderBase}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Character_Uid}}" />
                                            <TextBox
                                                Grid.Column="2"
                                                Style="{StaticResource AntTextBoxStyle}"
                                                Text="{Binding AppConfig.Uid, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                ToolTip="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Character_Uid_Tooltip}}" />
                                        </Grid>

                                    </Border>

                                </StackPanel>
                            </Border>

                            <ctrl:CardHeader
                                x:Name="SectionCombat"
                                Title="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Combat_Title}}"
                                Subtitle="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Combat_Sub}}" />

                            <Border Style="{StaticResource SectionBorder}">
                                <StackPanel Style="{StaticResource SectionStackPanel}">

                                    <Border Style="{StaticResource SectionFieldBorder}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Combat_ClearAfterBattle}}" />
                                            <Grid Grid.Column="2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="10" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <TextBox
                                                    Grid.Column="0"
                                                    Style="{StaticResource AntTextBoxStyle}"
                                                    Text="{Binding AppConfig.CombatTimeClearDelay, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    Style="{StaticResource SuffixText}"
                                                    Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Common_Seconds}}" />
                                            </Grid>
                                        </Grid>
                                    </Border>

                                    <Border Style="{StaticResource SectionFieldBorder}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Combat_ClearAfterTeleport}}" />
                                            <Border Grid.Column="2" HorizontalAlignment="Right">
                                                <ctrl:SwitchControl
                                                    IsChecked="{Binding AppConfig.ClearLogAfterTeleport, Mode=TwoWay}"
                                                    OffContent="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Switch_Off}}"
                                                    OnContent="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Switch_On}}" />
                                            </Border>
                                        </Grid>
                                    </Border>

                                    <Border Style="{StaticResource SectionFieldBorder}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Combat_DpsUpdateMode}}"
                                                ToolTip="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Combat_DpsUpdateMode_Tooltip}}"
                                                Grid.ColumnSpan="3" Margin="0,0,260,0" />
                                            <Border Grid.Column="2" HorizontalAlignment="Right">
                                                <ctrl:SwitchControl
                                                    IsChecked="{Binding AppConfig.DpsUpdateMode, Mode=TwoWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Active}"
                                                    OffContent="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Combat_DpsUpdateMode_Passive}}"
                                                    OnContent="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Combat_DpsUpdateMode_Active}}"
                                                    ToolTip="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Combat_DpsUpdateMode_Tooltip}}" />
                                            </Border>
                                        </Grid>
                                    </Border>

                                    <Border Style="{StaticResource SectionFieldBorder}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Combat_DpsUpdateInterval}}"
                                                ToolTip="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Combat_DpsUpdateInterval_Tooltip}}" />
                                            <Grid Grid.Column="2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="10" />
                                                    <ColumnDefinition Width="35" />
                                                    <ColumnDefinition Width="5" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <Slider
                                                    Grid.Column="0"
                                                    IsEnabled="{Binding AppConfig.DpsUpdateMode, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Active}"
                                                    IsSnapToTickEnabled="True"
                                                    Maximum="5000"
                                                    Minimum="100"
                                                    Style="{StaticResource AntSliderStyle}"
                                                    TickFrequency="100"
                                                    Value="{Binding AppConfig.DpsUpdateInterval, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    Style="{StaticResource SuffixText}"
                                                    Text="{Binding AppConfig.DpsUpdateInterval, Mode=OneWay}" />
                                                <TextBlock
                                                    Grid.Column="4"
                                                    Style="{StaticResource SuffixText}"
                                                    Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Common_Milliseconds}}" />
                                            </Grid>
                                        </Grid>
                                    </Border>

                                    <Border Style="{StaticResource SectionFieldBorder}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Display_NumberMode}}" />
                                            <ComboBox
                                                Grid.Column="2"
                                                ItemTemplate="{StaticResource LocalizedEnumTextBlockDataTemplate}"
                                                ItemsSource="{Binding AvailableNumberDisplayModes}"
                                                SelectedItem="{Binding SelectedNumberDisplayMode, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{StaticResource AntComboBoxStyle}" />
                                        </Grid>
                                    </Border>

                                    <Border Style="{StaticResource SectionFieldBorderBase}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Display_Opacity}}" />
                                            <Grid Grid.Column="2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="10" />
                                                    <ColumnDefinition Width="35" />
                                                </Grid.ColumnDefinitions>

                                                <Slider
                                                    Grid.Column="0"
                                                    IsSnapToTickEnabled="True"
                                                    Maximum="95"
                                                    Minimum="5"
                                                    Style="{StaticResource AntSliderStyle}"
                                                    TickFrequency="1"
                                                    Value="{Binding AppConfig.Opacity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    Style="{StaticResource SuffixText}"
                                                    Text="{Binding AppConfig.Opacity, Mode=OneWay}" />
                                            </Grid>
                                        </Grid>
                                    </Border>

                                    <Border Style="{StaticResource SectionFieldBorderBase}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Combat_MaxHistoryCount}}"
                                                ToolTip="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Combat_MaxHistoryCount_Tooltip}}" />
                                            <Grid Grid.Column="2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="10" />
                                                    <ColumnDefinition Width="35" />
                                                    <ColumnDefinition Width="5" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <Slider
                                                    Grid.Column="0"
                                                    IsSnapToTickEnabled="True"
                                                    Maximum="50"
                                                    Minimum="5"
                                                    Style="{StaticResource AntSliderStyle}"
                                                    TickFrequency="5"
                                                    Value="{Binding AppConfig.MaxHistoryCount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    Style="{StaticResource SuffixText}"
                                                    Text="{Binding AppConfig.MaxHistoryCount, Mode=OneWay}" />
                                                <TextBlock
                                                    Grid.Column="4"
                                                    Style="{StaticResource SuffixText}"
                                                    Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Common_Records}}" />
                                            </Grid>
                                        </Grid>
                                    </Border>

                                    <Border Style="{StaticResource SectionFieldBorderBase}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="Time Series Sample Capacity"
                                                ToolTip="Maximum number of data points stored for DPS/HPS/DTPS trend charts. Higher values show more history but use more memory. Range: 50-1000 samples." />
                                            <Grid Grid.Column="2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="10" />
                                                    <ColumnDefinition Width="50" />
                                                    <ColumnDefinition Width="5" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <Slider
                                                    Grid.Column="0"
                                                    IsSnapToTickEnabled="True"
                                                    Maximum="1000"
                                                    Minimum="50"
                                                    Style="{StaticResource AntSliderStyle}"
                                                    TickFrequency="50"
                                                    Value="{Binding AppConfig.TimeSeriesSampleCapacity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    Style="{StaticResource SuffixText}"
                                                    Text="{Binding AppConfig.TimeSeriesSampleCapacity, Mode=OneWay}" />
                                                <TextBlock
                                                    Grid.Column="4"
                                                    Style="{StaticResource SuffixText}"
                                                    Text="samples" />
                                            </Grid>
                                        </Grid>
                                    </Border>

                                </StackPanel>
                            </Border>

                            <ctrl:CardHeader
                                x:Name="SectionTheme"
                                Title="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Theme_Title}}"
                                Subtitle="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Section_Theme_Description}}" />

                            <Border Style="{StaticResource SectionBorder}">
                                <StackPanel Style="{StaticResource SectionStackPanel}">

                                    <Border Style="{StaticResource SectionFieldBorder}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Theme_WindowColor}}" />
                                            <Border Grid.Column="2" HorizontalAlignment="Right">
                                                <StackPanel Orientation="Horizontal">
                                                    <WrapPanel Margin="0,0,10,0">
                                                        <Button Background="#1690F8"
                                                                Command="{Binding SetThemeColorCommand}"
                                                                CommandParameter="#1690F8"
                                                                Style="{StaticResource ThemeButton}">
                                                            <Button.Template>
                                                                <ControlTemplate>
                                                                    <Border Background="{TemplateBinding Background}"
                                                                            Style="{StaticResource ThemeButtonBorder}">
                                                                        <TextBlock
                                                                            Style="{StaticResource SelectedIconfont}"
                                                                            Text="&#xe64d;"
                                                                            Visibility="{Binding AppConfig.ThemeColor, Converter={StaticResource EqualityToVisibilityConverter}, ConverterParameter=#1690F8}" />
                                                                    </Border>
                                                                </ControlTemplate>
                                                            </Button.Template>
                                                        </Button>
                                                        <Button Background="#FFA9A8"
                                                                Command="{Binding SetThemeColorCommand}"
                                                                CommandParameter="#FFA9A8"
                                                                Style="{StaticResource ThemeButton}">
                                                            <Button.Template>
                                                                <ControlTemplate>
                                                                    <Border Background="{TemplateBinding Background}"
                                                                            Style="{StaticResource ThemeButtonBorder}">
                                                                        <TextBlock
                                                                            Style="{StaticResource SelectedIconfont}"
                                                                            Text="&#xe64d;"
                                                                            Visibility="{Binding AppConfig.ThemeColor, Converter={StaticResource EqualityToVisibilityConverter}, ConverterParameter=#FFA9A8}" />
                                                                    </Border>
                                                                </ControlTemplate>
                                                            </Button.Template>
                                                        </Button>
                                                        <Button Background="#F7A0DD"
                                                                Command="{Binding SetThemeColorCommand}"
                                                                CommandParameter="#F7A0DD"
                                                                Style="{StaticResource ThemeButton}">
                                                            <Button.Template>
                                                                <ControlTemplate>
                                                                    <Border Background="{TemplateBinding Background}"
                                                                            Style="{StaticResource ThemeButtonBorder}">
                                                                        <TextBlock
                                                                            Style="{StaticResource SelectedIconfont}"
                                                                            Text="&#xe64d;"
                                                                            Visibility="{Binding AppConfig.ThemeColor, Converter={StaticResource EqualityToVisibilityConverter}, ConverterParameter=#F7A0DD}" />
                                                                    </Border>
                                                                </ControlTemplate>
                                                            </Button.Template>
                                                        </Button>
                                                        <Button Background="#2F2F2F"
                                                                Command="{Binding SetThemeColorCommand}"
                                                                CommandParameter="#2F2F2F"
                                                                Style="{StaticResource ThemeButton}">
                                                            <Button.Template>
                                                                <ControlTemplate>
                                                                    <Border Background="{TemplateBinding Background}"
                                                                            Style="{StaticResource ThemeButtonBorder}">
                                                                        <TextBlock
                                                                            Style="{StaticResource SelectedIconfont}"
                                                                            Text="&#xe64d;"
                                                                            Visibility="{Binding AppConfig.ThemeColor, Converter={StaticResource EqualityToVisibilityConverter}, ConverterParameter=#2F2F2F}" />
                                                                    </Border>
                                                                </ControlTemplate>
                                                            </Button.Template>
                                                        </Button>
                                                        <Button Background="#D0D0D0"
                                                                Command="{Binding SetThemeColorCommand}"
                                                                CommandParameter="#D0D0D0"
                                                                Style="{StaticResource ThemeButton}">
                                                            <Button.Template>
                                                                <ControlTemplate>
                                                                    <Border Background="{TemplateBinding Background}"
                                                                            Style="{StaticResource ThemeButtonBorder}">
                                                                        <TextBlock
                                                                            Style="{StaticResource SelectedIconfont}"
                                                                            Text="&#xe64d;"
                                                                            Visibility="{Binding AppConfig.ThemeColor, Converter={StaticResource EqualityToVisibilityConverter}, ConverterParameter=#D0D0D0}" />
                                                                    </Border>
                                                                </ControlTemplate>
                                                            </Button.Template>
                                                        </Button>
                                                    </WrapPanel>
                                                    
                                                    <!-- ⭐ 新增：自定义颜色按钮（多彩图标） -->
                                                    <Button x:Name="CustomColorButton" 
                                                            Width="30" Height="30"
                                                            Margin="5,0,0,0"
                                                            BorderBrush="#EEE" BorderThickness="1"
                                                            ToolTip="自定义颜色">
                                                        <Button.Background>
                                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                                <GradientStop Color="#FF0000" Offset="0.0"/>
                                                                <GradientStop Color="#FFFF00" Offset="0.25"/>
                                                                <GradientStop Color="#00FF00" Offset="0.5"/>
                                                                <GradientStop Color="#00FFFF" Offset="0.75"/>
                                                                <GradientStop Color="#0000FF" Offset="1.0"/>
                                                            </LinearGradientBrush>
                                                        </Button.Background>
                                                        <Button.Template>
                                                            <ControlTemplate>
                                                                <Border Background="{TemplateBinding Background}"
                                                                        Style="{StaticResource ThemeButtonBorder}">
                                                                    <TextBlock Style="{StaticResource SelectedIconfont}"
                                                                               Text="&#xe6ad;"
                                                                               Foreground="White"
                                                                               FontSize="16"/>
                                                                </Border>
                                                            </ControlTemplate>
                                                        </Button.Template>
                                                        <Button.Triggers>
                                                            <EventTrigger RoutedEvent="Button.Click">
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <BooleanAnimationUsingKeyFrames 
                                                                            Storyboard.TargetName="ColorPickerPopup"
                                                                            Storyboard.TargetProperty="IsOpen">
                                                                            <DiscreteBooleanKeyFrame KeyTime="0" Value="True"/>
                                                                        </BooleanAnimationUsingKeyFrames>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </EventTrigger>
                                                        </Button.Triggers>
                                                    </Button>
                                                    
                                                    <!-- ⭐ 颜色选择器 Popup -->
                                                    <Popup x:Name="ColorPickerPopup"
                                                           PlacementTarget="{Binding ElementName=CustomColorButton}"
                                                           Placement="Bottom"
                                                           StaysOpen="False"
                                                           AllowsTransparency="True">
                                                        <Border Background="White" 
                                                                BorderBrush="#999" 
                                                                BorderThickness="1"
                                                                CornerRadius="8">
                                                            <Border.Effect>
                                                                <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3" Color="Black"/>
                                                            </Border.Effect>
                                                            <ctrl:SimpleColorPicker 
                                                                SelectedColor="{Binding CurrentThemeColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                Margin="5"/>
                                                        </Border>
                                                    </Popup>
                                                </StackPanel>
                                            </Border>
                                        </Grid>
                                    </Border>

                                    <Border Style="{StaticResource SectionFieldBorder}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="39*" />
                                                <ColumnDefinition Width="*" MinWidth="10" />
                                                <ColumnDefinition Width="60*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock
                                                Grid.Column="0"
                                                Style="{StaticResource FieldName}"
                                                Text="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Theme_BackgroundImage}}" />
                                            <Grid Grid.Column="2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="10" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="5" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <TextBox
                                                    Grid.Column="0"
                                                    IsReadOnly="True"
                                                    Style="{StaticResource AntTextBoxStyle}"
                                                    Text="{Binding AppConfig.BackgroundImagePath, Mode=OneWay}"
                                                    ToolTip="{Binding AppConfig.BackgroundImagePath}" />
                                                <Button
                                                    Grid.Column="2"
                                                    Command="{Binding SelectBackgroundImageCommand}"
                                                    Content="{lex:Loc Key={x:Static loc:ResourcesKeys.Settings_Theme_SelectImage}}"
                                                    Padding="12,4"
                                                    Style="{StaticResource AutoSelectButton}" />
                                                <Button
                                                    Grid.Column="4"
                                                    Command="{Binding ClearBackgroundImageCommand}"
                                                    Content="清除"
                                                    Padding="12,4"
                                                    Style="{StaticResource AntButtonStyle}" />
                                            </Grid>
                                        </Grid>
                                    </Border>

                                </StackPanel>
                            </Border>

                        </StackPanel>
                    </ScrollViewer>
                </Border>

            </Grid>

            <ctrl:Footer
                Grid.Row="2"
                Height="50"
                CancelClick="Footer_CancelClick"
                CancelCommand="{Binding CancelCommand}"
                ConfirmClick="Footer_ConfirmClick"
                ConfirmCommand="{Binding ConfirmCommand}" />
        </Grid>
    </Border>
</Window>