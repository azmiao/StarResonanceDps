# Administrator Privilege Management

## Overview
The WPF application now supports **optional** administrator privileges that users can choose at runtime.

## Files Modified

### 1. `app.manifest`
- Set to `<requestedExecutionLevel level="asInvoker" />` - Application starts without elevation
- Users can restart with admin privileges when needed

### 2. `Utilities/ElevationHelper.cs` (NEW)
Utility class providing:
- `IsRunningAsAdministrator()` - Check current privilege level
- `RestartAsAdministrator()` - Restart app with elevation
- `PromptAndRestartAsAdministrator()` - Show dialog and restart if user accepts
- `GetPrivilegeLevelText()` - Get display string ("Administrator" or "Standard User")

### 3. `ViewModels/MainViewModel.cs`
Added properties and commands:
- `IsRunningAsAdmin` property - Bindable boolean showing current privilege status
- `RestartAsAdministratorCommand` - RelayCommand to trigger elevation

### 4. `Properties/Resources.resx` and `Resources.zh-CN.resx`
Added localized resource strings:
- `App_RestartAsAdmin_Message` / `App_RestartAsAdmin_Title`
- `App_AlreadyAdmin_Message` / `App_AlreadyAdmin_Title`
- `App_PrivilegeLevel_Admin` / `App_PrivilegeLevel_Standard`

These will be auto-generated into `ResourcesKeys` by the source generator after build.

## Usage Examples

### Example 1: Show Admin Status in UI

Add this to your XAML (e.g., in a status bar or menu):

```xaml
<!-- Show admin status badge -->
<TextBlock>
    <Run Text="Privilege: "/>
    <Run Text="{Binding IsRunningAsAdmin, Converter={StaticResource BoolToAdminTextConverter}}" 
         FontWeight="Bold"/>
</TextBlock>

<!-- Admin icon indicator -->
<TextBlock Text="???" 
           Visibility="{Binding IsRunningAsAdmin, Converter={StaticResource BooleanToVisibilityConverter}}"
           ToolTip="Running as Administrator"/>
```

### Example 2: Menu Item to Restart as Admin

```xaml
<MenuItem Header="Run as Administrator"
          Command="{Binding RestartAsAdministratorCommand}">
    <MenuItem.Icon>
        <TextBlock Text="???" FontSize="16"/>
    </MenuItem.Icon>
</MenuItem>
```

### Example 3: Button to Elevate

```xaml
<Button Content="Restart with Admin Privileges"
        Command="{Binding RestartAsAdministratorCommand}"
        Visibility="{Binding IsRunningAsAdmin, Converter={StaticResource InvertedBooleanToVisibilityConverter}}"/>
```

### Example 4: Check Before Admin Operation

```csharp
// In your ViewModel or service
if (!ElevationHelper.IsRunningAsAdministrator())
{
    // Prompt user to restart
    var elevated = ElevationHelper.PromptAndRestartAsAdministrator(
        "This feature requires administrator privileges.\n\nRestart as administrator?",
        _logger);
    
    if (!elevated)
    {
        // User declined, handle gracefully
        _dialogService.Show("Operation Cancelled", "Administrator privileges are required for this operation.");
        return;
    }
}

// Continue with admin operation
PerformAdminOperation();
```

### Example 5: Automatic Elevation on Startup (Optional)

In `App.xaml.cs` or startup code:

```csharp
protected override void OnStartup(StartupEventArgs e)
{
    base.OnStartup(e);
    
    // Check if admin is required for your app
    if (RequiresAdminPrivileges() && !ElevationHelper.IsRunningAsAdministrator())
    {
        ElevationHelper.PromptAndRestartAsAdministrator(
            "This application requires administrator privileges to function properly.",
            _logger);
        return;
    }
    
    // Continue normal startup
}
```

## Behavior

### Default Behavior (asInvoker)
- ? Application starts immediately without UAC prompt
- ? Runs with user's normal privileges
- ? User can choose to elevate when needed
- ? Better user experience for features that don't require admin

### When User Chooses to Elevate
1. User clicks "Run as Administrator" or similar UI element
2. `RestartAsAdministratorCommand` executes
3. UAC prompt appears
4. If user clicks "Yes":
   - Application restarts with admin privileges
   - `IsRunningAsAdmin` becomes `true`
5. If user clicks "No":
   - Application continues running with normal privileges
   - User can try again later

## Alternative: Always Require Admin

If you want to force admin privileges, change `app.manifest`:

```xml
<requestedExecutionLevel level="requireAdministrator" uiAccess="false" />
```

This will show UAC prompt every time the app starts (not recommended unless absolutely necessary).

## Testing

1. **Test as normal user**: Run the app normally - should start without UAC
2. **Test elevation**: Click "Restart as Administrator" - should show UAC prompt
3. **Test as admin**: Run app as admin - UI should show admin status

## Localization

The following keys have been added to `Resources.resx` and will be auto-generated by the source generator:

- `App_RestartAsAdmin_Message`: "Some features may require administrator privileges.\n\nWould you like to restart the application as administrator?"
- `App_RestartAsAdmin_Title`: "Administrator Privileges"
- `App_AlreadyAdmin_Title`: "Already Administrator"
- `App_AlreadyAdmin_Message`: "This application is already running with administrator privileges."
- `App_PrivilegeLevel_Admin`: "Administrator"
- `App_PrivilegeLevel_Standard`: "Standard User"

After building the project, these keys will be available as constants in the auto-generated `ResourcesKeys` class.

To add translations for other languages, edit the corresponding localized `.resx` files (e.g., `Resources.zh-CN.resx`).
